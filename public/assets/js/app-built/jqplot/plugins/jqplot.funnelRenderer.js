/**
 * jqPlot
 * Pure JavaScript plotting plugin using jQuery
 *
 * Version: 1.0.8
 * Revision: 1250
 *
 * Copyright (c) 2009-2013 Chris Leonello
 * jqPlot is currently available for use in all personal or commercial projects 
 * under both the MIT (http://www.opensource.org/licenses/mit-license.php) and GPL 
 * version 2.0 (http://www.gnu.org/licenses/gpl-2.0.html) licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly. 
 *
 * Although not required, the author would appreciate an email letting him 
 * know of any substantial use of jqPlot.  You can reach the author at: 
 * chris at jqplot dot com or see http://www.jqplot.com/info.php .
 *
 * If you are feeling kind and generous, consider supporting the project by
 * making a donation at: http://www.jqplot.com/donate.php .
 *
 * sprintf functions contained in jqplot.sprintf.js by Ash Searle:
 *
 *     version 2007.04.27
 *     author Ash Searle
 *     http://hexmen.com/blog/2007/03/printf-sprintf/
 *     http://hexmen.com/js/sprintf.js
 *     The author (Ash Searle) has placed this code in the public domain:
 *     "This code is unrestricted: you are free to use it however you like."
 * 
 */

(function(e){function t(t,n,r){r=r||{},r.axesDefaults=r.axesDefaults||{},r.legend=r.legend||{},r.seriesDefaults=r.seriesDefaults||{};var i=!1;if(r.seriesDefaults.renderer==e.jqplot.FunnelRenderer)i=!0;else if(r.series)for(var s=0;s<r.series.length;s++)r.series[s].renderer==e.jqplot.FunnelRenderer&&(i=!0);i&&(r.axesDefaults.renderer=e.jqplot.FunnelAxisRenderer,r.legend.renderer=e.jqplot.FunnelLegendRenderer,r.legend.preDraw=!0,r.sortData=!1,r.seriesDefaults.pointLabels={show:!1})}function n(t,n,r){for(var i=0;i<this.series.length;i++)this.series[i].renderer.constructor==e.jqplot.FunnelRenderer&&this.series[i].highlightMouseOver&&(this.series[i].highlightMouseDown=!1)}function r(t){for(var n=0;n<this.series.length;n++)this.series[n].seriesColors=this.seriesColors,this.series[n].colorGenerator=e.jqplot.colorGenerator}function i(e,t,n){var r=e.series[t],i=e.plugins.funnelRenderer.highlightCanvas;i._ctx.clearRect(0,0,i._ctx.canvas.width,i._ctx.canvas.height),r._highlightedPoint=n,e.plugins.funnelRenderer.highlightedSeriesIndex=t,r.renderer.drawSection.call(r,i._ctx,r._vertices[n],r.highlightColors[n],!1)}function s(e){var t=e.plugins.funnelRenderer.highlightCanvas;t._ctx.clearRect(0,0,t._ctx.canvas.width,t._ctx.canvas.height);for(var n=0;n<e.series.length;n++)e.series[n]._highlightedPoint=null;e.plugins.funnelRenderer.highlightedSeriesIndex=null,e.target.trigger("jqplotDataUnhighlight")}function o(e,t,n,r,o){if(r){var u=[r.seriesIndex,r.pointIndex,r.data],a=jQuery.Event("jqplotDataMouseOver");a.pageX=e.pageX,a.pageY=e.pageY,o.target.trigger(a,u);if(o.series[u[0]].highlightMouseOver&&(u[0]!=o.plugins.funnelRenderer.highlightedSeriesIndex||u[1]!=o.series[u[0]]._highlightedPoint)){var f=jQuery.Event("jqplotDataHighlight");f.which=e.which,f.pageX=e.pageX,f.pageY=e.pageY,o.target.trigger(f,u),i(o,u[0],u[1])}}else r==null&&s(o)}function u(e,t,n,r,o){if(r){var u=[r.seriesIndex,r.pointIndex,r.data];if(o.series[u[0]].highlightMouseDown&&(u[0]!=o.plugins.funnelRenderer.highlightedSeriesIndex||u[1]!=o.series[u[0]]._highlightedPoint)){var a=jQuery.Event("jqplotDataHighlight");a.which=e.which,a.pageX=e.pageX,a.pageY=e.pageY,o.target.trigger(a,u),i(o,u[0],u[1])}}else r==null&&s(o)}function a(e,t,n,r,i){var o=i.plugins.funnelRenderer.highlightedSeriesIndex;o!=null&&i.series[o].highlightMouseDown&&s(i)}function f(e,t,n,r,i){if(r){var s=[r.seriesIndex,r.pointIndex,r.data],o=jQuery.Event("jqplotDataClick");o.which=e.which,o.pageX=e.pageX,o.pageY=e.pageY,i.target.trigger(o,s)}}function l(e,t,n,r,i){if(r){var o=[r.seriesIndex,r.pointIndex,r.data],u=i.plugins.funnelRenderer.highlightedSeriesIndex;u!=null&&i.series[u].highlightMouseDown&&s(i);var a=jQuery.Event("jqplotDataRightClick");a.which=e.which,a.pageX=e.pageX,a.pageY=e.pageY,i.target.trigger(a,o)}}function c(){this.plugins.funnelRenderer&&this.plugins.funnelRenderer.highlightCanvas&&(this.plugins.funnelRenderer.highlightCanvas.resetCanvas(),this.plugins.funnelRenderer.highlightCanvas=null),this.plugins.funnelRenderer={},this.plugins.funnelRenderer.highlightCanvas=new e.jqplot.GenericCanvas;var t=e(this.targetId+" .jqplot-data-label");t.length?e(t[0]).before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this)):this.eventCanvas._elem.before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this));var n=this.plugins.funnelRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(e){s(e.data.plot)})}e.jqplot.FunnelRenderer=function(){e.jqplot.LineRenderer.call(this)},e.jqplot.FunnelRenderer.prototype=new e.jqplot.LineRenderer,e.jqplot.FunnelRenderer.prototype.constructor=e.jqplot.FunnelRenderer,e.jqplot.FunnelRenderer.prototype.init=function(t,i){this.padding={top:20,right:20,bottom:20,left:20},this.sectionMargin=6,this.fill=!0,this.shadowOffset=2,this.shadowAlpha=.07,this.shadowDepth=5,this.highlightMouseOver=!0,this.highlightMouseDown=!1,this.highlightColors=[],this.widthRatio=.2,this.lineWidth=2,this.dataLabels="percent",this.showDataLabels=!1,this.dataLabelFormatString=null,this.dataLabelThreshold=3,this._type="funnel",this.tickRenderer=e.jqplot.FunnelTickRenderer,t.highlightMouseDown&&t.highlightMouseOver==null&&(t.highlightMouseOver=!1),e.extend(!0,this,t),this._highlightedPoint=null,this._bases=[],this._atot,this._areas=[],this._lengths=[],this._angle,this._dataIndices=[],this._unorderedData=e.extend(!0,[],this.data);var s=e.extend(!0,[],this.data);for(var h=0;h<s.length;h++)s[h].push(h);this.data.sort(function(e,t){return t[1]-e[1]}),s.sort(function(e,t){return t[1]-e[1]});for(var h=0;h<s.length;h++)this._dataIndices.push(s[h][2]);if(this.highlightColors.length==0)for(var h=0;h<this.seriesColors.length;h++){var p=e.jqplot.getColorComponents(this.seriesColors[h]),d=[p[0],p[1],p[2]],v=d[0]+d[1]+d[2];for(var m=0;m<3;m++)d[m]=v>570?d[m]*.8:d[m]+.4*(255-d[m]),d[m]=parseInt(d[m],10);this.highlightColors.push("rgb("+d[0]+","+d[1]+","+d[2]+")")}i.postParseOptionsHooks.addOnce(r),i.postInitHooks.addOnce(n),i.eventListenerHooks.addOnce("jqplotMouseMove",o),i.eventListenerHooks.addOnce("jqplotMouseDown",u),i.eventListenerHooks.addOnce("jqplotMouseUp",a),i.eventListenerHooks.addOnce("jqplotClick",f),i.eventListenerHooks.addOnce("jqplotRightClick",l),i.postDrawHooks.addOnce(c)},e.jqplot.FunnelRenderer.prototype.setGridData=function(e){var t=0,n=[];for(var r=0;r<this.data.length;r++)t+=this.data[r][1],n.push([this.data[r][0],this.data[r][1]]);for(var r=0;r<n.length;r++)n[r][1]=n[r][1]/t;this._bases=new Array(n.length+1),this._lengths=new Array(n.length),this.gridData=n},e.jqplot.FunnelRenderer.prototype.makeGridData=function(e,t){var n=0,r=[];for(var i=0;i<this.data.length;i++)n+=this.data[i][1],r.push([this.data[i][0],this.data[i][1]]);for(var i=0;i<r.length;i++)r[i][1]=r[i][1]/n;return this._bases=new Array(r.length+1),this._lengths=new Array(r.length),r},e.jqplot.FunnelRenderer.prototype.drawSection=function(e,t,n,r){function u(){e.beginPath(),e.fillStyle=n,e.strokeStyle=n,e.lineWidth=s,e.moveTo(t[0][0],t[0][1]);for(var r=1;r<4;r++)e.lineTo(t[r][0],t[r][1]);e.closePath(),i?e.fill():e.stroke()}var i=this.fill,s=this.lineWidth;e.save();if(r)for(var o=0;o<this.shadowDepth;o++)e.save(),e.translate(this.shadowOffset*Math.cos(this.shadowAngle/180*Math.PI),this.shadowOffset*Math.sin(this.shadowAngle/180*Math.PI)),u();else u();if(r)for(var o=0;o<this.shadowDepth;o++)e.restore();e.restore()},e.jqplot.FunnelRenderer.prototype.draw=function(t,n,r,i){function M(e){var t=(k[1]-A[1])/(k[0]-A[0]),n=k[1]-t*k[0],r=e+k[1];return[(r-n)/t,r]}function _(e){var t=(L[1]-O[1])/(L[0]-O[0]),n=L[1]-t*L[0],r=e+L[1];return[(r-n)/t,r]}var s,o=r!=undefined?r:{},u=0,a=0,f=1;this._areas=[];if(r.legendInfo&&r.legendInfo.placement=="insideGrid"){var l=r.legendInfo;switch(l.location){case"nw":u=l.width+l.xoffset;break;case"w":u=l.width+l.xoffset;break;case"sw":u=l.width+l.xoffset;break;case"ne":u=l.width+l.xoffset,f=-1;break;case"e":u=l.width+l.xoffset,f=-1;break;case"se":u=l.width+l.xoffset,f=-1;break;case"n":a=l.height+l.yoffset;break;case"s":a=l.height+l.yoffset,f=-1;break;default:}}var c=f==1?this.padding.left+u:this.padding.left,h=f==1?this.padding.top+a:this.padding.top,p=f==-1?this.padding.right+u:this.padding.right,d=f==-1?this.padding.bottom+a:this.padding.bottom,v=o.shadow!=undefined?o.shadow:this.shadow,m=o.showLine!=undefined?o.showLine:this.showLine,g=o.fill!=undefined?o.fill:this.fill,y=t.canvas.width,b=t.canvas.height;this._bases[0]=y-c-p;var w=this._length=b-h-d,E=this._bases[0]*this.widthRatio;this._atot=w/2*(this._bases[0]+this._bases[0]*this.widthRatio),this._angle=Math.atan((this._bases[0]-E)/2/w);for(s=0;s<n.length;s++)this._areas.push(n[s][1]*this._atot);var S,x,T,N=0,C=1e-4;for(s=0;s<this._areas.length;s++){S=this._areas[s]/this._bases[s],x=999999,this._lengths[s]=S,T=0;while(x>this._lengths[s]*C&&T<100)this._lengths[s]=this._areas[s]/(this._bases[s]-this._lengths[s]*Math.tan(this._angle)),x=Math.abs(this._lengths[s]-S),this._bases[s+1]=this._bases[s]-2*this._lengths[s]*Math.tan(this._angle),S=this._lengths[s],T++;N+=this._lengths[s]}this._vertices=new Array(n.length);var k=[c,h],L=[c+this._bases[0],h],A=[c+(this._bases[0]-this._bases[this._bases.length-1])/2,h+this._length],O=[A[0]+this._bases[this._bases.length-1],A[1]],D=u,P=a,H=0,B=0;for(s=0;s<n.length;s++){this._vertices[s]=new Array;var j=this._vertices[s],F=this.sectionMargin;s==0&&(B=0),s==1?B=F/3:s>0&&s<n.length-1?B=F/2:s==n.length-1&&(B=2*F/3),j.push(M(H+B)),j.push(_(H+B)),H+=this._lengths[s],s==0?B=-2*F/3:s>0&&s<n.length-1?B=-F/2:s==n.length-1&&(B=0),j.push(_(H+B)),j.push(M(H+B))}if(this.shadow){var I="rgba(0,0,0,"+this.shadowAlpha+")";for(var s=0;s<n.length;s++)this.renderer.drawSection.call(this,t,this._vertices[s],I,!0)}for(var s=0;s<n.length;s++){var j=this._vertices[s];this.renderer.drawSection.call(this,t,j,this.seriesColors[s]);if(this.showDataLabels&&n[s][1]*100>=this.dataLabelThreshold){var q,R;this.dataLabels=="label"?(q=this.dataLabelFormatString||"%s",R=e.jqplot.sprintf(q,n[s][0])):this.dataLabels=="value"?(q=this.dataLabelFormatString||"%d",R=e.jqplot.sprintf(q,this.data[s][1])):this.dataLabels=="percent"?(q=this.dataLabelFormatString||"%d%%",R=e.jqplot.sprintf(q,n[s][1]*100)):this.dataLabels.constructor==Array&&(q=this.dataLabelFormatString||"%s",R=e.jqplot.sprintf(q,this.dataLabels[this._dataIndices[s]]));var U=this._radius*this.dataLabelPositionFactor+this.sliceMargin+this.dataLabelNudge,D=(j[0][0]+j[1][0])/2+this.canvas._offsets.left,P=(j[1][1]+j[2][1])/2+this.canvas._offsets.top,z=e('<span class="jqplot-funnel-series jqplot-data-label" style="position:absolute;">'+R+"</span>").insertBefore(i.eventCanvas._elem);D-=z.width()/2,P-=z.height()/2,D=Math.round(D),P=Math.round(P),z.css({left:D,top:P})}}},e.jqplot.FunnelAxisRenderer=function(){e.jqplot.LinearAxisRenderer.call(this)},e.jqplot.FunnelAxisRenderer.prototype=new e.jqplot.LinearAxisRenderer,e.jqplot.FunnelAxisRenderer.prototype.constructor=e.jqplot.FunnelAxisRenderer,e.jqplot.FunnelAxisRenderer.prototype.init=function(t){this.tickRenderer=e.jqplot.FunnelTickRenderer,e.extend(!0,this,t),this._dataBounds={min:0,max:100},this.min=0,this.max=100,this.showTicks=!1,this.ticks=[],this.showMark=!1,this.show=!1},e.jqplot.FunnelLegendRenderer=function(){e.jqplot.TableLegendRenderer.call(this)},e.jqplot.FunnelLegendRenderer.prototype=new e.jqplot.TableLegendRenderer,e.jqplot.FunnelLegendRenderer.prototype.constructor=e.jqplot.FunnelLegendRenderer,e.jqplot.FunnelLegendRenderer.prototype.init=function(t){this.numberRows=null,this.numberColumns=null,e.extend(!0,this,t)},e.jqplot.FunnelLegendRenderer.prototype.draw=function(){var t=this;if(this.show){var n=this._series,r="position:absolute;";r+=this.background?"background:"+this.background+";":"",r+=this.border?"border:"+this.border+";":"",r+=this.fontSize?"font-size:"+this.fontSize+";":"",r+=this.fontFamily?"font-family:"+this.fontFamily+";":"",r+=this.textColor?"color:"+this.textColor+";":"",r+=this.marginTop!=null?"margin-top:"+this.marginTop+";":"",r+=this.marginBottom!=null?"margin-bottom:"+this.marginBottom+";":"",r+=this.marginLeft!=null?"margin-left:"+this.marginLeft+";":"",r+=this.marginRight!=null?"margin-right:"+this.marginRight+";":"",this._elem=e('<table class="jqplot-table-legend" style="'+r+'"></table>');var i=!1,s=!1,o,u,a=n[0],f=new e.jqplot.ColorGenerator(a.seriesColors);if(a.show){var l=a.data;this.numberRows?(o=this.numberRows,this.numberColumns?u=this.numberColumns:u=Math.ceil(l.length/o)):this.numberColumns?(u=this.numberColumns,o=Math.ceil(l.length/this.numberColumns)):(o=l.length,u=1);var c,h,p,d,v,m,g,y,b=0;for(c=0;c<o;c++){s?p=e('<tr class="jqplot-table-legend"></tr>').prependTo(this._elem):p=e('<tr class="jqplot-table-legend"></tr>').appendTo(this._elem);for(h=0;h<u;h++)b<l.length&&(m=this.labels[b]||l[b][0].toString(),y=f.next(),s?c==o-1?i=!1:i=!0:c>0?i=!0:i=!1,g=i?this.rowSpacing:"0",d=e('<td class="jqplot-table-legend" style="text-align:center;padding-top:'+g+';">'+'<div><div class="jqplot-table-legend-swatch" style="border-color:'+y+';"></div>'+"</div></td>"),v=e('<td class="jqplot-table-legend" style="padding-top:'+g+';"></td>'),this.escapeHtml?v.text(m):v.html(m),s?(v.prependTo(p),d.prependTo(p)):(d.appendTo(p),v.appendTo(p)),i=!0),b++}}}return this._elem},e.jqplot.preInitHooks.push(t),e.jqplot.FunnelTickRenderer=function(){e.jqplot.AxisTickRenderer.call(this)},e.jqplot.FunnelTickRenderer.prototype=new e.jqplot.AxisTickRenderer,e.jqplot.FunnelTickRenderer.prototype.constructor=e.jqplot.FunnelTickRenderer})(jQuery);