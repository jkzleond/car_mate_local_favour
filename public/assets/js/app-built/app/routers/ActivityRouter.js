define(["jquery","backbone","text!/activity","collections/activity/ActivityCollection","views/activity/ActivityListView","views/activity/ActivityPubFormView","views/activity/ActivityDetailPageView","jqm","base64"],function(e,t,n,r,i,s,o){var u=t.Router.extend({initialize:function(){e(n).appendTo("body"),this.activity_all_list_view=new i({el:"#activity_list_view_all",collection:new r(null,{type:"all"})}),this.activity_my_list_view=new i({el:"#activity_list_view_my",collection:new r(null,{type:"my"})}),this.$navbar=e("#activity_navbar"),e("#activity_pub_btn").click(e.proxy(this._onActivityPubBtnClick,this)),this.activity_pub_form_view=new s({el:"#activity_pub_form_container"}),this.listenTo(this.activity_pub_form_view,"invalid:pub",this._onPubInvalid),this.listenTo(this.activity_pub_form_view,"activitygen",this._onNewActivityGen),this.activity_detail_page_view=new o,this.listenTo(this.activity_detail_page_view,"invalid:sign",this._onSignInValid),this.listenTo(this.activity_detail_page_view,"ordergen",this._onNewOrderGen)},_onActivityPubBtnClick:function(t){return e("#activity_pub_popup").popup("open"),!1},_onSignInValid:function(t,n){e.cm.toast({msg:n})},_onPubInvalid:function(t,n){e.cm.toast({msg:n})},_onNewActivityGen:function(e,t){this.navigate("activitise/my",{trigger:!0})},_onNewOrderGen:function(e,t){if(!t)return;var n="<root><orderId>"+t.order_id+"<orderId><orderNo>"+t.order_no+"</orderNo><orderFee>"+t.order_fee+"</orderFee><payType><offline>"+t.pay_type.offline+"</offline><alipay>"+t.pay_type.alipay+"</alipay><wxpay>"+t.pay_type.wxpay+"</wxpay></payType><des>"+encodeURIComponent(t.order_des)+"</des></root>";window.location.href="pay://yn.122.net/?ordername="+encodeURIComponent("活动收费项")+"&orderinfo="+encodeURIComponent(base64encode(n))},routes:{"activitise(/:type)":"index","activity/detail(/:id)":"activityDetail"},index:function(t){e(":mobile-pagecontainer").pagecontainer("change","#activitise_page"),t||(this.activity_all_list_view.collection.reset(),this.activity_my_list_view.collection.reset()),!t||t=="all"?(this.activity_all_list_view.collection.fetch(),this.activity_all_list_view.$el.show(),this.activity_my_list_view.$el.hide(),this.$navbar.find('[data-type-id="my"]').removeClass("ui-btn-active"),this.$navbar.find('[data-type-id="all"]').addClass("ui-btn-active")):t=="my"&&(this.activity_my_list_view.collection.fetch(),this.activity_my_list_view.$el.show(),this.activity_all_list_view.$el.hide(),this.$navbar.find('[data-type-id="all"]').removeClass("ui-btn-active"),this.$navbar.find('[data-type-id="my"]').addClass("ui-btn-active"))},activityDetail:function(t){e(":mobile-pagecontainer").pagecontainer("change","#activity_detail_page"),this.activity_detail_page_view.model.clear(),this.activity_detail_page_view.model.set({id:t},{silent:!0}),this.activity_detail_page_view.model.fetch()}});return u});