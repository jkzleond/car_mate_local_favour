define(["jquery","backbone","text!/insurance","models/insurance/InsuranceFormModel","collections/ProvinceCollection","collections/CityCollection","views/insurance/InsuranceFormView"],function(e,t,n,r,i,s,o){var u=t.Router.extend({initialize:function(){e(n).appendTo("body").enhanceWithin(),this.insurance_form_view=new o({el:"#insurance_form",model:new r,province_collection:new i,city_collection:new s,city_value:G.user.city_id||1}),this.listenTo(this.insurance_form_view,"submit",this.onFormSubmit),this.listenTo(this.insurance_form_view.model,"invalid",this.onFormDataInvalid)},onProvinceSelectChange:function(e,t,n){this.city_select_view.collection.setProvinceId(n)},onFormSubmit:function(){if(!this.insurance_form_view.model.isValid())return;var e=this;this.insurance_form_view.model.save(null,{success:function(t,n,r){n.success&&e.navigate("insurance/result/"+t.get("new_info_id"),{trigger:!0})}})},onFormDataInvalid:function(t,n){e.cm.toast({msg:n})},routes:{insurance:"index","insurance/result/:info_id":"insuranceResult"},index:function(){e(":mobile-pagecontainer").pagecontainer("change","#insurance_page"),this.insurance_form_view.setProvinceValue(G.user.province_id||1),this.insurance_form_view.province_collection.fetch({reset:!0})},insuranceResult:function(t){console.log(t),e(":mobile-pagecontainer").pagecontainer("change","#insurance_result_page")}});return u});