define(["backbone","models/DiscoveryModel"],function(e,t){var n=e.Collection.extend({model:t,initialize:function(e){this.type=e.type,this.has_change=["type","total"],this.page=1,this.rows=10,this.total=0},url:function(){return"/discoverise"},parse:function(e,t){return this._setTotal(e.total),e.rows},fetch:function(t){if(this.has_change.length==0)return;var t=t||{};t.data=t.data||{},t.data.criteria={type:this.type};var n=this.has_change.indexOf("page"),r=this.has_change.indexOf("total");if(this.has_change.indexOf("type")!=-1)t.reset=!0;else if(n!=-1&&r==-1&&this.total<this.page*this.rows){this.page-=1,this.has_change.splice(n,1);return}var i=this;if(typeof t.success=="function"){var s=t.success;t.success=function(){i.has_change.splice(0,i.has_change.length),s.apply(i,arguments)}}else t.success=function(){i.has_change.splice(0,i.has_change.length),i.type_has_change=!1};t.data.page=t.data.page||this.page,t.data.rows=t.data.rows||this.rows,e.Collection.prototype.fetch.call(this,t)},setType:function(e){if(this.type!=e){this.type=e;var t=this.has_change.indexOf("type");t==-1&&this.has_change.push("type"),this.trigger("change:type",this)}return this},setPage:function(e){if(this.page!=e){this.page=e;var t=this.has_change.indexOf("page");t==-1&&this.has_change.push("page"),this.trigger("change:page",this)}return this},setRows:function(e){if(this.rows!=e){this.rows=e;var t=this.has_change.indexOf("rows");t==-1&&this.has_change.push("rows"),this.trigger("change:rows",this)}return this},_setTotal:function(e){if(this.total!=e){this.total=e;var t=this.has_change.indexOf("total");t==-1&&this.has_change.push("total"),this.trigger("change:total",this)}return this.total<=this.page*this.rows&&this.trigger("page_end",this),this},nextPage:function(){this.setPage(this.page+1),this.fetch()}});return n});