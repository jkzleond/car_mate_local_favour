define(["underscore","backbone","models/DiscoveryModel","views/discovery/CommentListView","views/discovery/CommentFormView"],function(e,t,n,r,i){var s=t.View.extend({initialize:function(t){this.model||(this.model=new n),this.comment_form_view=new i({el:"#discovery_add_comment_popup"}),this.comment_list_view=new r({el:"#discovery_comments_container",collection:this.model.comments}),this.comment_more_href_tpl=e.template(this.$el.find("#discovery_comments_more").attr("href")),this.listenTo(this.model.comments,"change:total",this.renderCommentsTotal),this.listenTo(this.model,"change:id",this.clearPage),this.listenTo(this.model,"change:id",this.renderCommentMore),this.listenTo(this.model,"change:id",this._setCommentFormModelPid),this.listenTo(this.model,"change:title",this._renderTitle),this.listenTo(this.model,"change:content",this.renderContent),this.listenTo(this.comment_form_view,"commentgen",this._onCommentGen)},events:{"click #discovery_add_comment_btn":"_onAddCommentBtnClick"},_onAddCommentBtnClick:function(e){this.comment_form_view.open()},_onCommentGen:function(e,t){this.model.comments.reset(),this.model.comments.fetch()},_setCommentFormModelPid:function(e,t,n){this.comment_form_view.model.set("pid",t)},clearPage:function(e,t,n){this.$el.find("#discovery_content").html(""),this.$el.find("#discovery_comments_num").text("")},renderCommentsTotal:function(e){this.$el.find("#discovery_comments_num").text(e.total)},renderCommentMore:function(e){var t=this.comment_more_href_tpl({id:e.get("id")});this.$el.find("#discovery_comments_more").attr("href",t)},_renderTitle:function(e,t,n){$("title").text(t),e.set("title","",{silent:!0})},renderContent:function(e){var t="";if(e.get("id")==595){t='<iframe src="http://ip.yn122.net:8092/insurance_share/0?user_phone='+G.user.phone+"&location_url="+base64encode("http://ip.yn122.net:8092/insurance_share/"+G.user.phone)+'#discovery/detail/" frameborder="0" style="width:100%;height:100%"></iframe>';var n=$(window).height();this.$el.find("#discovery_content").height(n-80)}else t=e.get("content");this.$el.find("#discovery_content").html(t)}});return s});