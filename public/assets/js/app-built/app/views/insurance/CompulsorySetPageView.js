define(["jquery","underscore","backbone","models/insurance/InsuranceFormModel","models/insurance/InsuranceInfoModel","collections/insurance/InsuranceCompanyCollection","text!templates/insurance/compulsory_set_page.html","text!templates/insurance/discount_detail.html"],function(e,t,n,r,i,s,o,u){e(o).appendTo("body");var a=n.View.extend({model:new r,el:"#insurance_compulsory_set_page",initialize:function(){this.insurance_info=new i,this.company=new s,this.discount_detail_tpl=t.template(u),this.listenTo(this.model,"change:info_id",this._onNewInsuranceInfoGen),this.listenTo(this.insurance_info,"change:result",this._resultProcess),this.listenTo(this.company,"reset",this._discountProcess)},events:{"change [name=compulsory_state_id]":"_onCompulsoryStateChange","click .apply-actual-btn":"_onApplyActualBtnClick"},_onApplyActualBtnClick:function(e){this.trigger("uri",this,"insurance/apply_actual/"+this.insurance_info.get("id")+"/compulsory")},_onFormModelInvalid:function(t,n){e.cm.toast({msg:n})},_onNewInsuranceInfoGen:function(e,t,n){this.insurance_info.set("id",t,{silent:!0}),this.insurance_info.fetch()},_resultProcess:function(e,t,n){if(this.company.models.length==0)return;var r=this.company.models[0].attributes,i=this.insurance_info.result.attributes;this.$el.find(".discount-detail").empty().append(this.discount_detail_tpl({info:this.insurance_info.attributes,company:r,result:i})),this.$el.find(".apply-actual-btn").show()},_discountProcess:function(e,t){if(!this.insurance_info.result.get("totalStandard"))return;var n=this.company.models[0].attributes,r=this.insurance_info.result.attributes;this.$el.find(".discount-detail").empty().append(this.discount_detail_tpl({info:this.insurance_info.attributes,company:n,result:r})),this.$el.find(".apply-actual-btn").show()},reset:function(e){this.$el.find("[name=compulsory_state_id]").val(""),this.$el.find(".apply-actual-btn").hide(),this.$el.find(".discount-detail").empty(),this.insurance_info.clear({silent:!0}),this.insurance_info.result.clear({silent:!0}),this.company.fetch({reset:!0}),this.model.set("compulsory_state_id",e,{silent:!0}),this.model.save()}});return a});