define(["jquery","underscore","backbone","models/insurance/PolicyFormModel","collections/insurance/FinalResultCollection","text!templates/insurance/actuary_price_page.html","text!templates/insurance/result_detail.html","jqplot_bar","base64"],function(e,t,n,r,i,s,o){e(s).appendTo("body");var u=n.View.extend({el:"#insurance_actuary_price_page",initialize:function(e){this.form_model=new r,this.actuary_results=new i,this.result_detail_tpl=t.template(o),this.listenTo(this.actuary_results,"reset",this._render),this.listenTo(this.form_model,"invalid",this._onFormInvalid),this.listenTo(this.form_model,"sync",this._onApplyPolicySuccess)},events:{"click .apply-policy-btn":"_onApplyPolicyBtnClick"},_onApplyPolicyBtnClick:function(e){this.form_model.isValid()&&this.form_model.save()},_onFormInvalid:function(t,n){e.cm.toast({msg:n})},_onApplyPolicySuccess:function(e,t,n){t.success&&this.trigger("uri",this,"insurance/"+this.form_model.get("info_id")+"/pay_order")},_render:function(e,t){var n=this.actuary_results.models[0].attributes;this.form_model.set("company_id",n.company_id),this.form_model.set("result_id",n.result_id),this.$el.find(".result-detail").empty().append(this.result_detail_tpl({result:n}))},loadInfo:function(e){this._clear(),this.form_model.set("info_id",e,{silent:!0}),this.actuary_results.setInfoId(e),this.actuary_results.fetch({reset:!0})},_clear:function(){this.form_model.clear(),this.$el.find(".result-detail").empty()}});return u});